# Deeds App

The Deeds prototype demonstrates how a lightweight volunteering experience can run entirely on Cloudflare Workers. It includes an onboarding flow, a dashboard that hydrates profile data from the API, and a handful of supporting pages styled with Tailwind CSS.

## Key features
- D1-backed `users` table with hashed passwords and a `completed_deeds` counter.
- Session cookies issued by the Worker so the browser no longer persists credentials in `localStorage`.
- REST-style auth endpoints for sign-up, log-in, log-out, and profile hydration.
- Static frontend served from the `public/` bucket that fetches profile state from the API and renders it on each page.

## Project structure
```
/deeds-app/
├── functions/_worker.js      # Cloudflare Worker with auth + profile routes
├── migrations/               # D1 schema migrations
├── public/                   # Static frontend assets served by Workers Sites
│   ├── choose.html          # Curated opportunities list
│   ├── dashboard.html        # Post-login experience
│   ├── index.html            # Sign-up screen
│   ├── leaderboard.html      # Community leaderboard
│   ├── login.html            # Log-in screen
│   ├── profile.html          # Member profile
│   ├── submit.html           # Deed submission form
│   ├── verify.html           # Placeholder verification screen
│   ├── script.js             # Client-side auth + profile hydration
│   └── styles.css            # Shared base styles
├── package.json              # Tooling + scripts
└── wrangler.toml             # Worker configuration (D1 binding + site bucket)
```

## Getting started
1. Install dependencies:
   ```bash
   npm install
   ```
2. Create a D1 database and apply migrations:
   ```bash
   wrangler d1 create deeds-app-db
   wrangler d1 migrations apply deeds-app-db --local --remote
   ```
   Update `wrangler.toml` with the database ID generated by Cloudflare.
3. Start the Worker locally with static assets:
   ```bash
   npm run start
   ```
   The dev server proxies API requests to the Worker while serving the `public/` directory.

## Available scripts
```bash
npm run start   # wrangler dev
npm run deploy  # wrangler deploy
npm run lint    # prettier --check for frontend + worker sources
npm run format  # prettier --write for frontend + worker sources
```

## Authentication flow
- **Sign up**: `POST /api/auth/signup` with `{ name, email, password }` creates a user record, hashes the password, and seeds a `completed_deeds` counter.
- **Log in**: `POST /api/auth/login` with `{ email, password }` validates credentials and refreshes the session cookie.
- **Profile**: `GET /api/profile` returns `{ profile }` for the active session.
- **Log out**: `POST /api/auth/logout` clears the server-side session and expires the cookie.

All API responses set CORS headers and support credentialed requests so the browser can include the session cookie when fetching profile data.

## Frontend behavior
The shared `public/script.js` file wires up the forms across the prototype:
- Submits sign-up and log-in requests to the Worker and redirects to `dashboard.html` on success.
- Hydrates profile details on pages that include `data-profile-field` markers by calling `/api/profile`.
- Invalidates the cached profile and calls the log-out API when a `[data-action="logout"]` control is clicked.

With the session state now persisted in D1, refreshing the browser or opening a new tab keeps the user signed in until the Worker-issued cookie expires.
